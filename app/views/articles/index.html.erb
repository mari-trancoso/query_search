<div class="p-4 w-full">
  <h1 class="text-5xl font-bold text-center mb-6 text-red-500">Articles</h1>

  <div class="flex flex-col">
    <%= form_with url: articles_path, method: :get, id:"search-form" do |form| %>
      <%= form.text_field :query, id:"search-query", value: params[:query], placeholder: "Search", class: "w-full mb-2 rounded-md" %>
    <% end %>
    <%= link_to "Search Analytics", analytics_path, class:"bg-red-600 p-2 text-white rounded-md w-fit" %>
  </div>

  <div id="search-results" class="p-4">
    <% @articles.each do |article| %>
      <%= render article %>
    <% end %>
  </div>

  <%= link_to "New article", new_article_path, class:"bg-red-600 p-2 text-white rounded-md w-fit" %>
</div>

<script>
let debounceTimer;

document.getElementById('search-query').addEventListener('input', function() {
  clearTimeout(debounceTimer);
  debounceTimer = setTimeout(() => {
    const query = this.value;
    if (query.length > 1) {
      fetch(`/articles?query=${query}`, {
        headers: {
          'Accept': 'application/json'
        }
      })
      .then(response => response.json())
      .then(data => {
        const resultsDiv = document.getElementById('search-results');
        resultsDiv.innerHTML = '';
        data.forEach(article => {
          const articleDiv = document.createElement('div');
          articleDiv.innerHTML = `<h2>${article.title}</h2><p>${article.body}</p>`;
          resultsDiv.appendChild(articleDiv);
        });
      });
    }
  }, 300)
});
</script>
